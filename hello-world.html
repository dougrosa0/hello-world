<!DOCTYPE html>
<html>

<body onload="getTrends()">

    <h1>Hello world</h1>
    <p>Putting things I build here</p>
    <h2>US Trends</h2>
    <h3>Google search</h3>
    <table id="google-trends">
      <thead>
        <tr>
          <th>Rank</th>
          <th>Query</th>
          <th>Traffic Amount</th>
        </tr>
      </thead>
    </table>
    <p id="get-trends-result"></p>
    <button onclick="saveTrends()">Save trends</button>
    <p id="write-trends-result"></p>
    <button onclick="emailTrends()">Email me</button>
    <p id="email-trends-result"></p>

</body>

<script>
    function emailTrends() {
        var msg = 'Working...';
        document.getElementById("email-trends-result").innerHTML = msg;
        const sendEmailUrl = 'https://ajqc8nxe7e.execute-api.us-west-2.amazonaws.com/dev/email-trends';
        const requestOptions = {
            method: 'PUT'
        };
        fetch(sendEmailUrl, requestOptions)
            .then(response => {
                const success = response.status === 200;
                const closeBtn = ""
                if (success) {
                    msg = 'Sent';
                }
                else {
                    msg = 'Failed';
                }
                var resultMsg = document.getElementById("email-trends-result");
                resultMsg.innerHTML = msg;
                setTimeout(() => {
                    resultMsg.innerHTML = '';
                }, 1000);
            });
    }
    function getTrends() {
        var msg = 'Working...';
        var resultMsg = document.getElementById("get-trends-result");
        const table = document.getElementById("google-trends");
        resultMsg.innerHTML = msg;
        const getTrendUrl = 'https://ajqc8nxe7e.execute-api.us-west-2.amazonaws.com/dev';
        const requestOptions = {
            method: 'GET'
        };
        fetch(getTrendUrl, requestOptions)
            .then(response => {
                const success = response.status === 200;
                const closeBtn = ""
                if (success) {
                    response.json().then(data => {
                      msg = data;
                      const results = JSON.parse(data.body);
                      for (let i = 0; i < results.length; i++) {
                        const row = table.insertRow();
                        const rankCell = row.insertCell(0);
                        rankCell.innerHTML = results[i].dayRank;
                        const queryCell = row.insertCell(1);
                        queryCell.innerHTML = results[i].queryText;
                        const trafficCell = row.insertCell(2);
                        trafficCell.innerHTML = results[i].trafficAmount;
                      }
                      resultMsg.innerHTML = "";
                  }).catch(error => {
                      console.error('Error getting response body:', error);
                  })
                }
                else {
                    msg = 'Failed';
                    resultMsg.innerHTML = msg;
                }
            });
    }
    function saveTrends() {
        var msg = 'Working...';
        document.getElementById("write-trends-result").innerHTML = msg;
        const writeTrendUrl = 'https://ajqc8nxe7e.execute-api.us-west-2.amazonaws.com/dev';
        const requestOptions = {
            method: 'PUT'
        };
        fetch(writeTrendUrl, requestOptions)
            .then(response => {
                const success = response.status === 200;
                const closeBtn = ""
                if (success) {
                    msg = 'Success';
                }
                else {
                    msg = 'Failed';
                }
                var resultMsg = document.getElementById("write-trends-result");
                resultMsg.innerHTML = msg;
                setTimeout(() => {
                    resultMsg.innerHTML = '';
                }, 1000);
            });
    }
    function getLocalTime() {
      const now = new Date();
      const offsetMs = now.getTimezoneOffset() * 60 * 1000;
      const localMs = now.getTime() - offsetMs;
      const localTime = new Date(localMs).toISOString().slice(0, 19).replace('T', ' ');
      return localTime;
    }
</script>

</html>
